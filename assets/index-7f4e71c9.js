import{j as V,r as c,Y,c as U,i as q,a as F,R as G}from"./vendor-df3b8e8a.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))y(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const v of s.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&y(v)}).observe(document,{childList:!0,subtree:!0});function h(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function y(o){if(o.ep)return;o.ep=!0;const s=h(o);fetch(o.href,s)}})();const f=V.exports.jsx,j=V.exports.jsxs;var O=(t=>(t.AbortError="media_aborted",t.NotAllowedError="permission_denied",t.NotFoundError="no_specified_media_found",t.NotReadableError="media_in_use",t.OverconstrainedError="invalid_media_constraints",t.TypeError="no_constraints",t.NONE="",t.NO_RECORDER="recorder_error",t))(O||{});function $({audio:t=!0,video:l=!1,onStop:h=()=>null,onStart:y=()=>null,blobPropertyBag:o,screen:s=!1,mediaRecorderOptions:v=void 0,customMediaStream:P=null,stopStreamsOnStop:I=!0,askPermissionOnMount:A=!1}){const p=c.exports.useRef(null),w=c.exports.useRef([]),r=c.exports.useRef(null),[M,a]=c.exports.useState("idle"),[g,b]=c.exports.useState(!1),[E,T]=c.exports.useState(void 0),[_,k]=c.exports.useState("NONE"),x=c.exports.useCallback(async()=>{a("acquiring_media");const i={audio:typeof t=="boolean"?!!t:t,video:typeof l=="boolean"?!!l:l};try{if(P)r.current=P;else if(s){const d=await window.navigator.mediaDevices.getDisplayMedia({video:l||!0});d.getVideoTracks()[0].addEventListener("ended",()=>{m()}),t&&(await window.navigator.mediaDevices.getUserMedia({audio:t})).getAudioTracks().forEach(S=>d.addTrack(S)),r.current=d}else{const d=await window.navigator.mediaDevices.getUserMedia(i);r.current=d}a("idle")}catch(d){k(d.name),a("idle")}},[t,l,s]);c.exports.useEffect(()=>{if(!window.MediaRecorder)throw new Error("Unsupported Browser");if(s&&!window.navigator.mediaDevices.getDisplayMedia)throw new Error("This browser doesn't support screen capturing");const i=d=>{const R=navigator.mediaDevices.getSupportedConstraints(),S=Object.keys(d).filter(B=>!R[B]);S.length>0&&console.error(`The constraints ${S.join(",")} doesn't support on this browser. Please check your ReactMediaRecorder component.`)};return typeof t=="object"&&i(t),typeof l=="object"&&i(l),v!=null&&v.mimeType&&(MediaRecorder.isTypeSupported(v.mimeType)||console.error("The specified MIME type you supplied for MediaRecorder doesn't support this browser")),!r.current&&A&&x(),()=>{r.current&&r.current.getTracks().forEach(R=>R.clone().stop())}},[t,s,l,x,v,A]);const N=async()=>{if(k("NONE"),r.current||await x(),r.current){if(r.current.getTracks().some(d=>d.readyState==="ended")&&await x(),!r.current.active)return;p.current=new MediaRecorder(r.current,v??void 0),p.current.ondataavailable=C,p.current.onstop=D,p.current.onstart=L,p.current.onerror=()=>{k("NO_RECORDER"),a("idle")},p.current.start(),a("recording")}},C=({data:i})=>{w.current.push(i)},L=()=>{y()},D=()=>{const[i]=w.current,d=Object.assign({type:i.type},o??(l?{type:"video/mp4"}:{type:"audio/ogg; codecs=opus"})),R=new Blob(w.current,d),S=URL.createObjectURL(R);a("stopped"),T(S),h(S,R)},e=i=>{b(i),r.current&&r.current.getAudioTracks().forEach(d=>d.enabled=!i)},n=()=>{p.current&&p.current.state==="recording"&&(a("paused"),p.current.pause())},u=()=>{p.current&&p.current.state==="paused"&&(a("recording"),p.current.resume())},m=()=>{var i;p.current&&p.current.state!=="inactive"&&(a("stopping"),p.current.stop(),I&&((i=r==null?void 0:r.current)==null||i.getTracks().forEach(d=>d.stop())),w.current=[])};return{error:O[_],muteAudio:()=>e(!0),unMuteAudio:()=>e(!1),startRecording:N,pauseRecording:n,resumeRecording:u,stopRecording:m,mediaBlobUrl:E,status:M,isAudioMuted:g,previewStream:r.current?new MediaStream(r.current.getVideoTracks()):null,previewAudioStream:r.current?new MediaStream(r.current.getAudioTracks()):null,clearBlobUrl:()=>{E&&URL.revokeObjectURL(E),T(void 0),a("idle")}}}function K(){const[t,l]=c.exports.useState([]);return c.exports.useEffect(()=>{const h=async()=>{await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});const o=(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="audioinput").flat();l(o)};return h(),navigator.mediaDevices.addEventListener("devicechange",h),()=>navigator.mediaDevices.removeEventListener("devicechange",h)},[]),t}const W=U("video-id"),z=U("previous-videos"),H=U("lag-id");function J(){const[t,l]=c.exports.useState(void 0),h=K(),[y,o]=W("jcL38GYrk-I"),[s,v]=c.exports.useState(0),[P,I]=c.exports.useState(0),[A,p]=c.exports.useState(0),w=$({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,...t?{deviceId:t}:{}},video:!1,askPermissionOnMount:!0,onStart:()=>p(performance.now())}),[r,M]=c.exports.useState(!1),a=c.exports.useRef(null),g=c.exports.useRef(null),[b,E]=H(-56),T=c.exports.useRef(),_=()=>{var e;(e=g.current)==null||e.pause(),clearTimeout(T.current)},k=e=>{var u,m;clearTimeout(T.current);const n=e+(A-s)/1e3+b/1e3-P;if(n<0)g.current&&(g.current.currentTime=0),T.current=setTimeout(()=>{var i;return(i=g.current)==null?void 0:i.play()},n*-1e3*(1/(((u=g.current)==null?void 0:u.playbackRate)??1)));else{g.current&&(g.current.currentTime=n);const i=performance.now();(m=g.current)==null||m.play().then(()=>console.log("playback lag",performance.now()-i))}},x=async()=>{var e;await((e=a.current)==null?void 0:e.getInternalPlayer().pauseVideo()),setTimeout(async()=>{var u,m;M(!0);const n=await((u=a.current)==null?void 0:u.internalPlayer.getCurrentTime());I(n),(m=a.current)==null||m.internalPlayer.playVideo()},100)},N=()=>{var e,n;(e=a.current)==null||e.internalPlayer.seekTo(0),(n=a.current)==null||n.internalPlayer.playVideo()};c.exports.useEffect(()=>{var n;const e=g.current;e&&!e.paused&&!e.ended&&!!e.currentTime&&((n=a.current)==null||n.getInternalPlayer().getCurrentTime().then(u=>{e.currentTime=u+(A-s)/1e3+b/1e3-P}))},[b,g]);const C=()=>{M(!1),w.stopRecording()},[L,D]=z([]);return j("div",{className:"App",children:[f("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:L.map(({id:e,title:n})=>f("button",{onClick:()=>o(e),disabled:e===y,children:n},e))}),f("input",{value:y,onChange:e=>{const n=e.target.value;try{const m=new URL(n).searchParams.get("v");if(m)o(m);else throw new Error("invalid link")}catch{o(n)}}}),f(Y,{ref:a,videoId:y,id:"youtube-player",onPlaybackRateChange:async()=>{var n,u;const e=await((n=a.current)==null?void 0:n.getInternalPlayer().getPlaybackRate());g.current&&(g.current.playbackRate=e),k(await((u=a.current)==null?void 0:u.getInternalPlayer().getCurrentTime()))},onPlay:()=>{var e,n;if(r?(v(performance.now()),w.startRecording()):(e=a.current)==null||e.internalPlayer.getCurrentTime().then(k),!L.find(({id:u})=>y===u)){const u=((n=document.getElementById("youtube-player"))==null?void 0:n.title)??y;D(m=>[{id:y,title:u},...m].slice(0,10))}},onEnd:r?C:_,onPause:r?C:_}),f("audio",{src:w.mediaBlobUrl,controls:!0,ref:g}),!r&&f("button",{onClick:x,children:"record"}),r&&f("button",{onClick:C,children:"stop recording"}),f("button",{onClick:N,children:"replay"}),j("div",{children:[f("input",{type:"number",step:4,value:b,onChange:e=>E(+e.target.value)}),f("br",{}),f("input",{type:"range",min:-250,max:250,value:b,onChange:e=>E(+e.target.value),style:{width:640}})]}),f("div",{children:f("select",{onChange:e=>l(e.target.value),value:t??"default",children:h.map(e=>f("option",{value:e.deviceId,children:e.label},e.deviceId))})})]})}function Q(){return window.isE2ETests||window.location.search.includes("e2e-test")}({}).VITE_APP_SENTRY_DSN_URL&&q({dsn:{}.VITE_APP_SENTRY_DSN_URL,tracesSampleRate:1,environment:Q()?"e2e":"production"});F.createRoot(document.getElementById("root")).render(f(G.StrictMode,{children:f(J,{})}));
//# sourceMappingURL=index-7f4e71c9.js.map
