import{j as V,r as i,Y,c as L,i as q,a as F,R as G}from"./vendor-df3b8e8a.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))E(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&E(f)}).observe(document,{childList:!0,subtree:!0});function T(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function E(o){if(o.ep)return;o.ep=!0;const s=T(o);fetch(o.href,s)}})();const m=V.exports.jsx,U=V.exports.jsxs;var D=(r=>(r.AbortError="media_aborted",r.NotAllowedError="permission_denied",r.NotFoundError="no_specified_media_found",r.NotReadableError="media_in_use",r.OverconstrainedError="invalid_media_constraints",r.TypeError="no_constraints",r.NONE="",r.NO_RECORDER="recorder_error",r))(D||{});function $({audio:r=!0,video:u=!1,onStop:T=()=>null,onStart:E=()=>null,blobPropertyBag:o,screen:s=!1,mediaRecorderOptions:f=void 0,customMediaStream:_=null,stopStreamsOnStop:P=!0,askPermissionOnMount:b=!1}){const a=i.exports.useRef(null),d=i.exports.useRef([]),e=i.exports.useRef(null),[w,g]=i.exports.useState("idle"),[A,C]=i.exports.useState(!1),[k,M]=i.exports.useState(void 0),[N,h]=i.exports.useState("NONE"),R=i.exports.useCallback(async()=>{g("acquiring_media");const p={audio:typeof r=="boolean"?!!r:r,video:typeof u=="boolean"?!!u:u};try{if(_)e.current=_;else if(s){const c=await window.navigator.mediaDevices.getDisplayMedia({video:u||!0});c.getVideoTracks()[0].addEventListener("ended",()=>{j()}),r&&(await window.navigator.mediaDevices.getUserMedia({audio:r})).getAudioTracks().forEach(S=>c.addTrack(S)),e.current=c}else{const c=await window.navigator.mediaDevices.getUserMedia(p);e.current=c}g("idle")}catch(c){h(c.name),g("idle")}},[r,u,s]);i.exports.useEffect(()=>{if(!window.MediaRecorder)throw new Error("Unsupported Browser");if(s&&!window.navigator.mediaDevices.getDisplayMedia)throw new Error("This browser doesn't support screen capturing");const p=c=>{const v=navigator.mediaDevices.getSupportedConstraints(),S=Object.keys(c).filter(B=>!v[B]);S.length>0&&console.error(`The constraints ${S.join(",")} doesn't support on this browser. Please check your ReactMediaRecorder component.`)};return typeof r=="object"&&p(r),typeof u=="object"&&p(u),f!=null&&f.mimeType&&(MediaRecorder.isTypeSupported(f.mimeType)||console.error("The specified MIME type you supplied for MediaRecorder doesn't support this browser")),!e.current&&b&&R(),()=>{e.current&&e.current.getTracks().forEach(v=>v.clone().stop())}},[r,s,u,R,f,b]);const I=async()=>{if(h("NONE"),e.current||await R(),e.current){if(e.current.getTracks().some(c=>c.readyState==="ended")&&await R(),!e.current.active)return;a.current=new MediaRecorder(e.current,f??void 0),a.current.ondataavailable=t,a.current.onstop=l,a.current.onstart=n,a.current.onerror=()=>{h("NO_RECORDER"),g("idle")},a.current.start(),g("recording")}},t=({data:p})=>{d.current.push(p)},n=()=>{E()},l=()=>{const[p]=d.current,c=Object.assign({type:p.type},o??(u?{type:"video/mp4"}:{type:"audio/ogg; codecs=opus"})),v=new Blob(d.current,c),S=URL.createObjectURL(v);g("stopped"),M(S),T(S,v)},y=p=>{C(p),e.current&&e.current.getAudioTracks().forEach(c=>c.enabled=!p)},x=()=>{a.current&&a.current.state==="recording"&&(g("paused"),a.current.pause())},O=()=>{a.current&&a.current.state==="paused"&&(g("recording"),a.current.resume())},j=()=>{var p;a.current&&a.current.state!=="inactive"&&(g("stopping"),a.current.stop(),P&&((p=e==null?void 0:e.current)==null||p.getTracks().forEach(c=>c.stop())),d.current=[])};return{error:D[N],muteAudio:()=>y(!0),unMuteAudio:()=>y(!1),startRecording:I,pauseRecording:x,resumeRecording:O,stopRecording:j,mediaBlobUrl:k,status:w,isAudioMuted:A,previewStream:e.current?new MediaStream(e.current.getVideoTracks()):null,previewAudioStream:e.current?new MediaStream(e.current.getAudioTracks()):null,clearBlobUrl:()=>{k&&URL.revokeObjectURL(k),M(void 0),g("idle")}}}const K=L("video-id"),W=L("previous-videos"),z=L("lag-id");function H(){const[r,u]=K("jcL38GYrk-I"),[T,E]=i.exports.useState(0),[o,s]=i.exports.useState(0),[f,_]=i.exports.useState(0),P=$({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1},video:!1,askPermissionOnMount:!0,onStart:()=>_(performance.now())}),[b,a]=i.exports.useState(!1),d=i.exports.useRef(null),e=i.exports.useRef(null),[w,g]=z(-56),A=i.exports.useRef(),C=()=>{var t;(t=e.current)==null||t.pause(),clearTimeout(A.current)},k=t=>{var l,y;clearTimeout(A.current);const n=t+(f-T)/1e3+w/1e3-o;if(n<0)e.current&&(e.current.currentTime=0),A.current=setTimeout(()=>{var x;return(x=e.current)==null?void 0:x.play()},n*-1e3*(1/(((l=e.current)==null?void 0:l.playbackRate)??1)));else{e.current&&(e.current.currentTime=n);const x=performance.now();(y=e.current)==null||y.play().then(()=>console.log("playback lag",performance.now()-x))}},M=async()=>{var t;await((t=d.current)==null?void 0:t.getInternalPlayer().pauseVideo()),setTimeout(async()=>{var l,y;a(!0);const n=await((l=d.current)==null?void 0:l.internalPlayer.getCurrentTime());s(n),(y=d.current)==null||y.internalPlayer.playVideo()},100)},N=()=>{var t,n;(t=d.current)==null||t.internalPlayer.seekTo(0),(n=d.current)==null||n.internalPlayer.playVideo()};i.exports.useEffect(()=>{var n;const t=e.current;t&&!t.paused&&!t.ended&&!!t.currentTime&&((n=d.current)==null||n.getInternalPlayer().getCurrentTime().then(l=>{t.currentTime=l+(f-T)/1e3+w/1e3-o}))},[w,e]);const h=()=>{a(!1),P.stopRecording()},[R,I]=W([]);return U("div",{className:"App",children:[m("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:R.map(({id:t,title:n})=>m("button",{onClick:()=>u(t),disabled:t===r,children:n},t))}),m("input",{value:r,onChange:t=>u(t.target.value)}),m(Y,{ref:d,videoId:r,id:"youtube-player",onPlaybackRateChange:async()=>{var n,l;const t=await((n=d.current)==null?void 0:n.getInternalPlayer().getPlaybackRate());e.current&&(e.current.playbackRate=t),k(await((l=d.current)==null?void 0:l.getInternalPlayer().getCurrentTime()))},onPlay:()=>{var t,n;if(b?(E(performance.now()),P.startRecording()):(t=d.current)==null||t.internalPlayer.getCurrentTime().then(k),!R.find(({id:l})=>r===l)){const l=((n=document.getElementById("youtube-player"))==null?void 0:n.title)??r;I(y=>[{id:r,title:l},...y].slice(0,10))}},onEnd:b?h:C,onPause:b?h:C}),m("audio",{src:P.mediaBlobUrl,controls:!0,ref:e}),!b&&m("button",{onClick:M,children:"record"}),b&&m("button",{onClick:h,children:"stop recording"}),m("button",{onClick:N,children:"replay"}),U("div",{children:[m("input",{type:"number",step:4,value:w,onChange:t=>g(+t.target.value)}),m("br",{}),m("input",{type:"range",min:-250,max:250,value:w,onChange:t=>g(+t.target.value),style:{width:640}})]})]})}function J(){return window.isE2ETests||window.location.search.includes("e2e-test")}({}).VITE_APP_SENTRY_DSN_URL&&q({dsn:{}.VITE_APP_SENTRY_DSN_URL,tracesSampleRate:1,environment:J()?"e2e":"production"});F.createRoot(document.getElementById("root")).render(m(G.StrictMode,{children:m(H,{})}));
//# sourceMappingURL=index-82b4c454.js.map
