import{j as U,r as i,Y as q,c as I,a as Y,R as F}from"./vendor-5ed0fa47.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))T(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&T(f)}).observe(document,{childList:!0,subtree:!0});function S(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function T(o){if(o.ep)return;o.ep=!0;const s=S(o);fetch(o.href,s)}})();const y=U.exports.jsx,O=U.exports.jsxs;var V=(r=>(r.AbortError="media_aborted",r.NotAllowedError="permission_denied",r.NotFoundError="no_specified_media_found",r.NotReadableError="media_in_use",r.OverconstrainedError="invalid_media_constraints",r.TypeError="no_constraints",r.NONE="",r.NO_RECORDER="recorder_error",r))(V||{});function G({audio:r=!0,video:u=!1,onStop:S=()=>null,onStart:T=()=>null,blobPropertyBag:o,screen:s=!1,mediaRecorderOptions:f=void 0,customMediaStream:M=null,stopStreamsOnStop:A=!0,askPermissionOnMount:b=!1}){const a=i.exports.useRef(null),d=i.exports.useRef([]),e=i.exports.useRef(null),[h,g]=i.exports.useState("idle"),[C,P]=i.exports.useState(!1),[x,N]=i.exports.useState(void 0),[_,w]=i.exports.useState("NONE"),v=i.exports.useCallback(async()=>{g("acquiring_media");const p={audio:typeof r=="boolean"?!!r:r,video:typeof u=="boolean"?!!u:u};try{if(M)e.current=M;else if(s){const c=await window.navigator.mediaDevices.getDisplayMedia({video:u||!0});c.getVideoTracks()[0].addEventListener("ended",()=>{L()}),r&&(await window.navigator.mediaDevices.getUserMedia({audio:r})).getAudioTracks().forEach(k=>c.addTrack(k)),e.current=c}else{const c=await window.navigator.mediaDevices.getUserMedia(p);e.current=c}g("idle")}catch(c){w(c.name),g("idle")}},[r,u,s]);i.exports.useEffect(()=>{if(!window.MediaRecorder)throw new Error("Unsupported Browser");if(s&&!window.navigator.mediaDevices.getDisplayMedia)throw new Error("This browser doesn't support screen capturing");const p=c=>{const R=navigator.mediaDevices.getSupportedConstraints(),k=Object.keys(c).filter(B=>!R[B]);k.length>0&&console.error(`The constraints ${k.join(",")} doesn't support on this browser. Please check your ReactMediaRecorder component.`)};return typeof r=="object"&&p(r),typeof u=="object"&&p(u),f!=null&&f.mimeType&&(MediaRecorder.isTypeSupported(f.mimeType)||console.error("The specified MIME type you supplied for MediaRecorder doesn't support this browser")),!e.current&&b&&v(),()=>{e.current&&e.current.getTracks().forEach(R=>R.clone().stop())}},[r,s,u,v,f,b]);const j=async()=>{if(w("NONE"),e.current||await v(),e.current){if(e.current.getTracks().some(c=>c.readyState==="ended")&&await v(),!e.current.active)return;a.current=new MediaRecorder(e.current,f??void 0),a.current.ondataavailable=t,a.current.onstop=l,a.current.onstart=n,a.current.onerror=()=>{w("NO_RECORDER"),g("idle")},a.current.start(),g("recording")}},t=({data:p})=>{d.current.push(p)},n=()=>{T()},l=()=>{const[p]=d.current,c=Object.assign({type:p.type},o??(u?{type:"video/mp4"}:{type:"audio/ogg; codecs=opus"})),R=new Blob(d.current,c),k=URL.createObjectURL(R);g("stopped"),N(k),S(k,R)},m=p=>{P(p),e.current&&e.current.getAudioTracks().forEach(c=>c.enabled=!p)},E=()=>{a.current&&a.current.state==="recording"&&(g("paused"),a.current.pause())},D=()=>{a.current&&a.current.state==="paused"&&(g("recording"),a.current.resume())},L=()=>{var p;a.current&&a.current.state!=="inactive"&&(g("stopping"),a.current.stop(),A&&((p=e==null?void 0:e.current)==null||p.getTracks().forEach(c=>c.stop())),d.current=[])};return{error:V[_],muteAudio:()=>m(!0),unMuteAudio:()=>m(!1),startRecording:j,pauseRecording:E,resumeRecording:D,stopRecording:L,mediaBlobUrl:x,status:h,isAudioMuted:C,previewStream:e.current?new MediaStream(e.current.getVideoTracks()):null,previewAudioStream:e.current?new MediaStream(e.current.getAudioTracks()):null,clearBlobUrl:()=>{x&&URL.revokeObjectURL(x),N(void 0),g("idle")}}}const $=I("video-id"),K=I("previous-videos"),W=I("lag-id");function z(){const[r,u]=$("jcL38GYrk-I"),[S,T]=i.exports.useState(0),[o,s]=i.exports.useState(0),[f,M]=i.exports.useState(0),A=G({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1},video:!1,askPermissionOnMount:!0,onStart:()=>M(performance.now())}),[b,a]=i.exports.useState(!1),d=i.exports.useRef(null),e=i.exports.useRef(null),[h,g]=W(-56),C=i.exports.useRef(),P=()=>{var t;(t=e.current)==null||t.pause(),clearTimeout(C.current)},x=t=>{var l,m;clearTimeout(C.current);const n=t+(f-S)/1e3+h/1e3-o;if(n<0)e.current&&(e.current.currentTime=0),C.current=setTimeout(()=>{var E;return(E=e.current)==null?void 0:E.play()},n*-1e3*(1/(((l=e.current)==null?void 0:l.playbackRate)??1)));else{e.current&&(e.current.currentTime=n);const E=performance.now();(m=e.current)==null||m.play().then(()=>console.log("playback lag",performance.now()-E))}},N=async()=>{var t;await((t=d.current)==null?void 0:t.getInternalPlayer().pauseVideo()),setTimeout(async()=>{var l,m;a(!0);const n=await((l=d.current)==null?void 0:l.internalPlayer.getCurrentTime());s(n),(m=d.current)==null||m.internalPlayer.playVideo()},100)},_=()=>{var t,n;(t=d.current)==null||t.internalPlayer.seekTo(0),(n=d.current)==null||n.internalPlayer.playVideo()};i.exports.useEffect(()=>{var n;const t=e.current;t&&!t.paused&&!t.ended&&!!t.currentTime&&((n=d.current)==null||n.getInternalPlayer().getCurrentTime().then(l=>{t.currentTime=l+(f-S)/1e3+h/1e3-o}))},[h,e]);const w=()=>{a(!1),A.stopRecording()},[v,j]=K([]);return O("div",{className:"App",children:[y("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:v.map(({id:t,title:n})=>y("button",{onClick:()=>u(t),disabled:t===r,children:n},t))}),y("input",{value:r,onChange:t=>u(t.target.value)}),y(q,{ref:d,videoId:r,id:"youtube-player",onPlaybackRateChange:async()=>{var n,l;const t=await((n=d.current)==null?void 0:n.getInternalPlayer().getPlaybackRate());e.current&&(e.current.playbackRate=t),x(await((l=d.current)==null?void 0:l.getInternalPlayer().getCurrentTime()))},onPlay:()=>{var t,n;if(b?(T(performance.now()),A.startRecording()):(t=d.current)==null||t.internalPlayer.getCurrentTime().then(x),!v.find(({id:l})=>r===l)){const l=((n=document.getElementById("youtube-player"))==null?void 0:n.title)??r;j(m=>[{id:r,title:l},...m].slice(0,10))}},onEnd:b?w:P,onPause:b?w:P}),y("audio",{src:A.mediaBlobUrl,controls:!0,ref:e}),!b&&y("button",{onClick:N,children:"record"}),b&&y("button",{onClick:w,children:"stop recording"}),y("button",{onClick:_,children:"replay"}),O("div",{children:[y("input",{type:"number",step:4,value:h,onChange:t=>g(+t.target.value)}),y("br",{}),y("input",{type:"range",min:-250,max:250,value:h,onChange:t=>g(+t.target.value),style:{width:640}})]})]})}Y.createRoot(document.getElementById("root")).render(y(F.StrictMode,{children:y(z,{})}));
//# sourceMappingURL=index-287bc161.js.map
